name: ğŸ”‘ ØªÙˆÙ„ÙŠØ¯ TOKEN_PICKLE

on:
  workflow_dispatch:

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: ğŸ Ø¥Ø¹Ø¯Ø§Ø¯ Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: ğŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
        run: pip install google-auth-oauthlib
      
      - name: ğŸ” Ø¥Ù†Ø´Ø§Ø¡ client_secret.json
        env:
          CLIENT_SECRET_JSON: ${{ secrets.CLIENT_SECRET_JSON }}
        run: |
          echo "$CLIENT_SECRET_JSON" > client_secret.json
          echo "âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ client_secret.json"
      
      - name: ğŸ« ØªÙˆÙ„ÙŠØ¯ Token
        run: |
          cat > generate.py << 'EOF'
from google_auth_oauthlib.flow import InstalledAppFlow
import pickle, base64, sys

SCOPES = ['https://www.googleapis.com/auth/blogger']

try:
    flow = InstalledAppFlow.from_client_secrets_file('client_secret.json', SCOPES)
    creds = flow.run_local_server(port=0)
    
    token = base64.b64encode(pickle.dumps(creds)).decode()
    
    print("ğŸ« **Ø§Ù†Ø³Ø® ÙƒÙ„ Ù…Ø§ Ø¨ÙŠÙ† Ø§Ù„Ø®Ø·ÙˆØ·:**")
    print("="*80)
    print(token)
    print("="*80)
    print("\nğŸ“‹ **ÙƒÙŠÙÙŠØ© Ø§Ù„Ø¥Ø¶Ø§ÙØ©:**")
    print("1. Settings â†’ Secrets â†’ Actions")
    print("2. New repository secret")
    print("3. Name: TOKEN_PICKLE")
    print("4. Value: Ø§Ù„ØµÙ‚ Ø§Ù„Ù€Token Ø§Ù„ÙƒØ§Ù…Ù„")
    print("5. Add secret")
    
    # Ø­ÙØ¸ ÙÙŠ Ù…Ù„Ù
    with open('TOKEN.txt', 'w') as f:
        f.write(token)
        
except Exception as e:
    print(f"âŒ Ø®Ø·Ø£: {e}")
    sys.exit(1)
EOF
          python generate.py
      
      - name: ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù€Token ÙÙŠ artifact
        if: success()
        uses: actions/upload-artifact@v3
        with:
          name: blogger-token
          path: TOKEN.txt
