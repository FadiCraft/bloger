name: ðŸ”„ Ø§Ù„Ù†Ø´Ø± Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±

on:
  # 1. Ø¹Ù†Ø¯ Ø±ÙØ¹ Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ posts
  push:
    paths:
      - 'posts/**'
      - 'scripts/publish.py'
    branches: [ main, master ]
  
  # 2. ÙŠØ¯ÙˆÙŠØ§Ù‹ Ù…Ù† ØµÙØ­Ø© Actions
  workflow_dispatch:
  
  # 3. Ø¹Ù„Ù‰ Ø¬Ø¯ÙˆÙ„ Ø²Ù…Ù†ÙŠ (ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 8 ØµØ¨Ø§Ø­Ø§Ù‹)
  schedule:
    - cron: '0 8 * * *'  # UTC time

# Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
permissions:
  contents: write  # Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø´ÙŠÙ

jobs:
  publish-to-blogger:
    runs-on: ubuntu-latest
    
    steps:
      # 1. ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
      - name: â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹
        uses: actions/checkout@v3
        with:
          fetch-depth: 0  # ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø§Ù„ØªØ§Ø±ÙŠØ®
      
      # 2. Ø¥Ø¹Ø¯Ø§Ø¯ Python
      - name: ðŸ Ø¥Ø¹Ø¯Ø§Ø¯ Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      # 3. ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
      - name: ðŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
      
      # 4. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¬Ù„Ø¯ posts Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
      - name: ðŸ“ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
        run: |
          mkdir -p posts
          mkdir -p published
          
          # Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø¬Ù„Ø¯ posts ÙØ§Ø±ØºØ§Ù‹ØŒ Ø£Ù†Ø´Ø¦ Ù…Ù‚Ø§Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©
          if [ -z "$(ls -A posts/)" ]; then
            cat > posts/Ù…Ù‚Ø§Ù„Ø©-ØªØ¬Ø±ÙŠØ¨ÙŠØ©.md << 'EOF'
# Ø£ÙˆÙ„ Ù…Ù‚Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
Ù…Ø±Ø­Ø¨Ø§Ù‹! Ù‡Ø°Ù‡ Ø£ÙˆÙ„ Ù…Ù‚Ø§Ù„Ø© ØªÙ†Ø´Ø± ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ø¨Ø± GitHub Actions.

## ÙƒÙŠÙ ØªØ¹Ù…Ù„ØŸ
1. Ø¶Ø¹ Ù…Ù‚Ø§Ù„Ø§ØªÙƒ ÙÙŠ Ù…Ø¬Ù„Ø¯ `posts` Ø¨ØµÙŠØºØ© Markdown
2. Ø§Ù„Ø³ÙƒØ±ÙŠØ¨Øª Ø³ÙŠÙ†Ø´Ø±Ù‡Ø§ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
3. Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© ØªÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ `published`

**ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… ØªÙ†Ø³ÙŠÙ‚ Markdown:**
- Ù†Ù‚Ø§Ø·
- *Ù…Ø§Ø¦Ù„*
- **Ø¹Ø±ÙŠØ¶**
- [Ø±ÙˆØ§Ø¨Ø·](https://blogger.com)

EOF
            echo "ðŸ“ ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù‚Ø§Ù„Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ©"
          fi
      
      # 5. ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù†Ø´Ø±
      - name: ðŸš€ ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù†Ø´Ø±
        env:
          # **** Ù‡Ù†Ø§ ØªØ­Ø·Ù‡Ù…! ****
          BLOG_ID: ${{ secrets.BLOG_ID }}
          CLIENT_SECRET_JSON: ${{ secrets.CLIENT_SECRET_JSON }}
          TOKEN_PICKLE: ${{ secrets.TOKEN_PICKLE }}
        run: |
          echo "ðŸ”§ Ø¨Ø¯Ø¡ Ø§Ù„Ù†Ø´Ø±..."
          python scripts/publish.py
      
      # 6. ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹ Ø¨Ù†Ù‚Ù„ Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©
      - name: ðŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª
        run: |
          git config --global user.email "github-actions@github.com"
          git config --global user.name "GitHub Actions"
          git add .
          git commit -m "ðŸš€ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø´ÙŠÙ [Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒ]" || echo "Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©"
          git push || echo "Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø±ÙØ¹ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª"
      
      # 7. Ø¥Ø¹Ù„Ø§Ù… Ø¨Ù†Ø¬Ø§Ø­ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©
      - name: ðŸ“¢ Ø¥Ø¹Ù„Ø§Ù… Ø¨Ø§Ù„Ù†ØªÙŠØ¬Ø©
        if: success()
        run: |
          echo "âœ… ØªÙ… ØªÙ†ÙÙŠØ° Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­!"
          echo "ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø¯ÙˆÙ†ØªÙƒ Ø¹Ù„Ù‰ Ø¨Ù„ÙˆØ¬Ø±"
