name: Publish to Blogger

on:
  push:
    paths:
      - 'posts/**'  # ÙŠØ´ØºÙ„ Ø§Ù„ workflow ÙÙ‚Ø· Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± posts/
    branches: [ main ]
  schedule:
    - cron: '0 8 * * *'  # ÙŠØ´ØºÙ„ ÙƒÙ„ ÙŠÙˆÙ… Ø§Ù„Ø³Ø§Ø¹Ø© 8 ØµØ¨Ø§Ø­Ø§Ù‹ (ØªÙˆÙ‚ÙŠØª UTC)
  workflow_dispatch:  # ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  publish:
    runs-on: ubuntu-latest
    
    steps:
    - name: â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
      uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: ðŸ Ø¥Ø¹Ø¯Ø§Ø¯ Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: ðŸ“¦ ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ÙƒØªØ¨Ø§Øª
      run: |
        pip install -r requirements.txt

    - name: ðŸ”§ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨ÙŠØ¦Ø©
      env:
        BLOG_ID: ${{ secrets.BLOG_ID }}
      run: |
        # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù client_secret.json Ù…Ù† Secrets
        echo '${{ secrets.CLIENT_SECRET_JSON }}' > client_secret.json
        
        # ØªØ´ØºÙŠÙ„ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„Ù†Ø´Ø±
        python scripts/publish.py

    - name: ðŸ“¤ Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø©
      run: |
        # Ù†Ù‚Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø© Ø¥Ù„Ù‰ Ù…Ø¬Ù„Ø¯ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
        mkdir -p published
        mv posts/*.md published/ 2>/dev/null || true
        git config --global user.email "github-actions@github.com"
        git config --global user.name "GitHub Actions"
        git add .
        git commit -m "Move published posts to archive" || true
        git push || true
